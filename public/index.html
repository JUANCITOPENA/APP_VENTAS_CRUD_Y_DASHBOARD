<!DOCTYPE html>
<html lang="es">

<head>
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/8899/8899687.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Ventas Avanzado</title>

    <!-- Estilos locales -->
    <link rel="stylesheet" href="style.css">

    <!-- Font Awesome para Ã­conos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
          integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Chart.js para grÃ¡ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

    <!-- Plugin Chart.js para etiquetas -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>

    <!-- html2canvas para capturas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
            integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- jsPDF para exportar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
            integrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DKjRdigISdsRCXVCARZFC8LljNhm9uoLPLAClPMtMAVR_xTp8C5g132Cw=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Estilo interno (Loading Overlay y Resumen Ejecutivo) -->
    <style>
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.85);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000; font-size: 1.5rem; color: #333; text-align: center;
            backdrop-filter: blur(3px); transition: opacity 0.3s ease-out; opacity: 1;
        }
        #loading-overlay > div { padding: 2rem; background: #fff; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        #loading-overlay i { margin-bottom: 1rem; font-size: 3rem; color: #3498db; }
        #loading-overlay .loading-message { color: #333; font-size: 16px; margin-top: 10px; }
        #loading-overlay.hidden { opacity: 0; pointer-events: none; }

        /* Estilos para el Resumen Ejecutivo */
        .executive-summary-section { margin-top: 25px; margin-bottom: 25px; }
        .executive-summary-box {
            background-color: var(--card-bg); padding: 20px 25px; border-radius: 8px;
            border: 1px solid var(--border-color); box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            line-height: 1.6; max-width: 95%; margin-left: auto; margin-right: auto;
        }
        .text-justify { text-align: justify; }
        body.dark-mode .executive-summary-box { box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); }
        .highlight-positive { color: var(--color-positive, #28a745); font-weight: bold; }
        .highlight-negative { color: var(--color-negative, #dc3545); font-weight: bold; }
        .highlight-neutral { color: var(--color-warning, #ffc107); font-weight: bold; }
        .highlight-key { color: var(--color-primary, #007bff); font-weight: bold; }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div>
            <i class="fas fa-spinner fa-spin" aria-hidden="true"></i><br>
            Cargando datos del dashboard...
        </div>
    </div>

    <!-- Header -->
    <header>
        <h1>
            <i class="fas fa-chart-pie" aria-hidden="true"></i> Dashboard de Ventas Avanzado
        </h1>
          <!-- La Imagen es el segundo elemento Flex -->
          <img src="https://avatars.githubusercontent.com/u/38921558?v=4" alt="Avatar" class="navbar-avatar">
        <nav class="main-nav" aria-label="NavegaciÃ³n Principal">
            <ul>
                <li><a href="/" class="active" aria-current="page">Dashboard</a></li>
                <li><a href="/ventas.html">Gestionar Ventas</a></li>
            </ul>
        </nav>
        <!-- BotÃ³n de Modo Oscuro -->
        <button id="darkModeBtn" class="theme-switcher" title="Cambiar tema" aria-label="Cambiar tema">
            <i class="fas fa-moon"></i>
        </button>
    </header>

    <!-- Controles Principales -->
    <div class="page-controls">
        <div class="export-container">
            <button id="exportPdfBtn" class="button">
                <i class="fas fa-file-pdf" aria-hidden="true"></i> Descargar PDF
            </button>
        </div>
    </div>

    <!-- Contenido Principal -->
    <main>
        <!-- SecciÃ³n 1: KPIs Principales (Cards) -->
        <section class="kpi-section card-section" aria-labelledby="kpi-heading">
            <h2 id="kpi-heading">Resumen General</h2>
            <div class="kpi-container">
                <!-- KPI Card 1: Ingreso Total -->
                <div class="kpi-card" id="kpiIngresoTotal">
                    <div class="kpi-icon"><i class="fas fa-dollar-sign" aria-hidden="true"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-title">Ingreso Total</span>
                        <span class="kpi-value">--</span>
                        <span class="kpi-comparison">--</span>
                    </div>
                </div>
                <!-- KPI Card 2: Margen Total -->
                <div class="kpi-card" id="kpiMargenTotal">
                    <div class="kpi-icon"><i class="fas fa-piggy-bank" aria-hidden="true"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-title">Margen Total</span>
                        <span class="kpi-value">--</span>
                        <span class="kpi-comparison">Margen Acumulado</span>
                    </div>
                </div>
                <!-- KPI Card 3: Margen Porcentual -->
                <div class="kpi-card" id="kpiMargenPorc">
                    <div class="kpi-icon"><i class="fas fa-percentage" aria-hidden="true"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-title">Margen %</span>
                        <span class="kpi-value">--</span>
                        <span class="kpi-indicator">--</span>
                    </div>
                </div>
                <!-- KPI Card 4: Unidades Totales -->
                <div class="kpi-card" id="kpiCantidad">
                    <div class="kpi-icon"><i class="fas fa-box-open" aria-hidden="true"></i></div>
                    <div class="kpi-content">
                        <span class="kpi-title">Unidades Totales</span>
                        <span class="kpi-value">--</span>
                    </div>
                </div>
            </div>
            <!-- PÃ¡rrafo para la narrativa de KPIs (Mantenido por si se usa aÃºn) -->
            <p class="narrative large-narrative" id="kpi-narrative">Cargando resumen ejecutivo...</p>
        </section>
        <!-- FIN SecciÃ³n 1 -->


        <!-- ============================================================ -->
        <!-- === NUEVA SECCIÃ“N: RESUMEN EJECUTIVO ======================= -->
        <!-- ============================================================ -->
        <section class="executive-summary-section" aria-labelledby="executive-summary-heading">
            <h2 id="executive-summary-heading" style="text-align: center; margin-bottom: 15px;">
                ğŸ“ Resumen Ejecutivo y Estado General ğŸ“Š
            </h2>
            <div class="narrative large-narrative executive-summary-box text-justify" id="executiveSummaryNarrative">
                <p><em>ğŸ§  Analizando los datos globales para ofrecer una visiÃ³n consolidada del rendimiento...</em></p>
            </div>
        </section>
        <!-- ============================================================ -->
        <!-- === FIN NUEVA SECCIÃ“N ====================================== -->
        <!-- ============================================================ -->


        <!-- SecciÃ³n 2: EvoluciÃ³n Anual de Ventas -->
        <section class="chart-section" aria-labelledby="evolucion-heading">
            <h2 id="evolucion-heading">ğŸ“ˆ EvoluciÃ³n Anual ğŸ“‰</h2>
            <div class="chart-container">
                <canvas id="ventasAnualesChart" role="img" aria-label="GrÃ¡fico de barras de ventas anuales"></canvas>
                <p class="narrative" id="ventasAnualesNarrative">ğŸ“‰ Analizando la tendencia histÃ³rica de ingresos...</p>
            </div>
            <div class="chart-container">
                <canvas id="crecimientoAnualChart" role="img" aria-label="GrÃ¡fico de barras de crecimiento porcentual anual"></canvas>
                <p class="narrative" id="crecimientoAnualNarrative">ğŸ“ˆ Evaluando la variaciÃ³n porcentual aÃ±o tras aÃ±o...</p>
            </div>
        </section>

        <!-- SecciÃ³n 3: Rentabilidad y Costos -->
        <section class="chart-section" aria-labelledby="rentabilidad-heading">
            <h2 id="rentabilidad-heading">ğŸ’° AnÃ¡lisis de Rentabilidad</h2>
            <div class="chart-container large-chart">
                <canvas id="resumenFinancieroChart" role="img" aria-label="GrÃ¡fico de barras de desglose financiero"></canvas>
                <p class="narrative" id="resumenFinancieroNarrative">Desglosando los componentes financieros clave...</p>
            </div>
            <div class="table-container small-table">
                <h3>DistribuciÃ³n %</h3>
                <table id="rentabilidadTable" aria-label="Tabla de distribuciÃ³n porcentual de rentabilidad">
                    <thead>
                        <tr>
                            <th scope="col">Componente</th>
                            <th scope="col" class="text-right">% s/ Ingreso</th>
                            <th scope="col" class="text-center">Indicador</th>
                        </tr>
                    </thead>
                    <tbody id="rentabilidadTableBody">
                        <tr><td colspan="3" class="text-center">Cargando...</td></tr>
                    </tbody>
                </table>
                <p class="narrative" id="rentabilidadTableNarrative">Comparando la proporciÃ³n del costo y margen sobre el ingreso total...</p>
            </div>
        </section>

        <!-- SecciÃ³n 4: Detalles Anuales y KPIs Consolidados -->
        <section class="table-section full-width" aria-labelledby="detalles-heading">
            <h2 id="detalles-heading">ğŸ“Š Detalles y KPIs Consolidados ğŸ“‰</h2>
            <div class="table-container half-width">
                <h3>ğŸ“… Comparativa Anual Detallada ğŸ“‰</h3>
                <table id="anualDetailTable" aria-label="Tabla de comparaciÃ³n anual detallada de ventas">
                    <thead>
                        <tr>
                            <th scope="col">AÃ±o</th>
                            <th scope="col" class="text-right">Ventas ğŸ’°</th>
                            <th scope="col" class="text-right">Dif. Absoluta ğŸ”„</th>
                            <th scope="col" class="text-right">Crecim. (%) ğŸ“ˆ</th>
                            <th scope="col" class="text-center">Tendencia ğŸ“‰</th>
                        </tr>
                    </thead>
                    <tbody id="anualDetailTableBody">
                        <tr><td colspan="5" class="text-center">Cargando...</td></tr>
                    </tbody>
                </table>
                <p class="narrative" id="anualDetailTableNarrative">ğŸ“Š Tabla resumen del rendimiento anual y su evoluciÃ³n.</p>
            </div>
            <div class="table-container half-width">
                <h3>ğŸ“Š Indicadores Clave (KPIs) ğŸ“‰</h3>
                <table id="kpiTable" aria-label="Tabla de indicadores clave de rendimiento (KPIs)">
                    <thead>
                        <tr>
                            <th scope="col">Indicador ğŸ†</th>
                            <th scope="col" class="text-right">Valor ğŸ“Š</th>
                            <th scope="col" class="text-center">Estado ğŸ”</th>
                        </tr>
                    </thead>
                    <tbody id="kpiTableBody">
                        <tr><td colspan="3" class="text-center">Cargando...</td></tr>
                    </tbody>
                </table>
                <p class="narrative" id="kpiTableNarrative">ğŸ“Š Vista consolidada de las mÃ©tricas mÃ¡s importantes.</p>
            </div>
        </section>

        <!-- SecciÃ³n 6: AnÃ¡lisis GeogrÃ¡fico y por Vendedor -->
        <section class="chart-section" aria-labelledby="geo-seller-heading">
            <h2 id="geo-seller-heading">ğŸŒ Rendimiento por UbicaciÃ³n y Vendedor ğŸ¢</h2>
            <div class="chart-container">
                <!-- Cambiado tÃ­tulo para reflejar grÃ¡fico de regiÃ³n -->
                <h3>ğŸŒ Ventas por RegiÃ³n ğŸ’°</h3>
                <canvas id="regionSalesChart" role="img" aria-label="GrÃ¡fico de barras de ventas totales por regiÃ³n"></canvas>
                <p class="narrative" id="regionSalesNarrative">Identificando las regiones con mayor volumen de ventas...</p>
            </div>
            <div class="chart-container">
                <h3>ğŸ¢ Top Vendedores (por Ventas) ğŸ“ˆ</h3>
                <canvas id="sellerSalesChart" role="img" aria-label="GrÃ¡fico de barras horizontales de los mejores vendedores por ventas"></canvas>
                <p class="narrative" id="sellerSalesNarrative">Destacando a los vendedores con mejor desempeÃ±o en ingresos...</p>
            </div>
        </section>

        <!-- SecciÃ³n 7: AnÃ¡lisis por Cliente y Producto -->
        <section class="chart-section" aria-labelledby="customer-product-heading">
            <h2 id="customer-product-heading">ğŸ›’ï¸ AnÃ¡lisis por Cliente y Producto ğŸ“Š</h2>
            <div class="chart-container">
                <h3>ğŸ¢ Top Clientes (por Compras) ğŸ’°</h3>
                <canvas id="customerSalesChart" role="img" aria-label="GrÃ¡fico de barras horizontales de los principales clientes por total de compras"></canvas>
                <p class="narrative" id="customerSalesNarrative">Reconociendo a los clientes que mÃ¡s aportan al negocio...</p>
            </div>
            <div class="chart-container">
                <h3>ğŸ›’ Top Productos (por Ventas) ğŸ“ˆ</h3> <!-- Emoji cambiado -->
                <canvas id="productSalesChart" role="img" aria-label="GrÃ¡fico de barras horizontales de los productos mÃ¡s vendidos"></canvas>
                <p class="narrative" id="productSalesNarrative">Visualizando los productos estrella en tÃ©rminos de ingresos...</p>
            </div>
        </section>

        <!-- SecciÃ³n 8: AnÃ¡lisis Pareto de Productos -->
        <section class="chart-section" aria-labelledby="pareto-heading">
            <h2>ğŸ“Š AnÃ¡lisis Pareto de Productos (80/20) ğŸ“ˆ</h2>
            <div class="chart-container large-chart">
                <canvas id="productParetoChart" role="img" aria-label="GrÃ¡fico combinado de Pareto mostrando ventas por producto y porcentaje acumulado"></canvas>
                <p class="narrative large-narrative" id="productParetoNarrative">Aplicando el principio 80/20 para identificar los productos vitales que generan la mayor parte de los ingresos...</p>
            </div>
        </section>

        <!-- SecciÃ³n 9: Otros AnÃ¡lisis Anuales -->
        <section class="chart-section" aria-labelledby="extra-anual-heading">
            <h2 id="extra-anual-heading">ğŸ“Š Otros AnÃ¡lisis Anuales ğŸ“‰</h2>
            <div class="chart-container">
                <h3>DistribuciÃ³n Anual %</h3>
                <canvas id="distribucionVentasChart" role="img" aria-label="GrÃ¡fico de dona de distribuciÃ³n de ventas por aÃ±o"></canvas>
                <p class="narrative" id="distribucionVentasNarrative">DistribuciÃ³n porcentual de las ventas anuales en el total histÃ³rico analizado.</p>
            </div>
            <div class="chart-container">
                <h3>ğŸ“ŠğŸ“ˆ Tendencia Anual: Ventas vs Crecimiento ğŸ’°ğŸ”¥</h3>
                <canvas id="tendenciaAcumuladaChart" role="img" aria-label="GrÃ¡fico combinado de ventas anuales vs crecimiento porcentual"></canvas>
                <p class="narrative" id="tendenciaAcumuladaNarrative">CorrelaciÃ³n entre el volumen de ventas anual (barras) y la tasa de crecimiento respecto al aÃ±o anterior (lÃ­nea).</p>
            </div>
        </section>

        <!-- SecciÃ³n 10: AnÃ¡lisis Pareto de Clientes con SemÃ¡foro -->
        <section class="chart-section" aria-labelledby="customer-pareto-heading">
            <h2 id="customer-pareto-heading">ğŸ“ŠğŸ” AnÃ¡lisis Pareto de Clientes ğŸ“ŠğŸ”</h2>
            <div class="chart-container large-chart">
                <canvas id="customerParetoChart" role="img" aria-label="GrÃ¡fico combinado de Pareto mostrando ventas por cliente y porcentaje acumulado, con barras coloreadas condicionalmente"></canvas>
                <p class="narrative large-narrative" id="customerParetoNarrative">Identificando la concentraciÃ³n de ventas en clientes clave y su clasificaciÃ³n (Verde: Vitales, Amarillo: Importantes, Rojo: Ocasionales)...</p>
            </div>
        </section>

        <!-- SecciÃ³n 11: KPIs Adicionales (GrÃ¡ficos Promedio Venta y Top Cantidad) -->
        <!-- (Esta secciÃ³n la omito segÃºn tu Ãºltima peticiÃ³n, pero si la necesitas, irÃ­a aquÃ­) -->
        <!--
        <section class="chart-section" aria-labelledby="kpi-adicional-heading">
            <h2 id="kpi-adicional-heading">ğŸ“Š KPIs Adicionales ğŸ“ˆ</h2>
            <div class="chart-container">
                <h3>ğŸ’° Valor Promedio de Venta por RegiÃ³n ($) ğŸŒ</h3>
                <canvas id="promedioVentaPorRegionChart" role="img" aria-label="GrÃ¡fico de barras del valor promedio de venta por regiÃ³n"></canvas>
                <p class="narrative" id="promedioVentaRegionNarrative">Calculando el ticket promedio por regiÃ³n...</p>
            </div>
            <div class="chart-container">
                <h3>â­ Top 5 Productos (por Cantidad Vendida) ğŸ›’</h3>
                <canvas id="topProductosCantidadChart" role="img" aria-label="GrÃ¡fico de barras de los 5 productos mÃ¡s vendidos por cantidad"></canvas>
                <p class="narrative" id="topProductosCantidadNarrative">Identificando los productos mÃ¡s populares en unidades...</p>
            </div>
        </section>
        -->

    </main>

    <!-- Footer -->
    <footer>
        <p>Dashboard generado con Chart.js Â© <span id="current-year"></span></p>
        <script>document.getElementById('current-year').textContent = new Date().getFullYear();</script>
    </footer>

    <Scripts de LibrerÃ­as (ya incluidos en head, pero a veces se ponen al final)></Scripts>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script> 

    <!-- Script Principal -->
    <script src="script.js"></script>
</body>

</html>